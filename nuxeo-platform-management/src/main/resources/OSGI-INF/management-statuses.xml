<?xml version="1.0"?>
<component name="org.nuxeo.ecm.platform.management.statuses">

  <implementation
    class="org.nuxeo.ecm.platform.management.statuses.StatusManagementComponent" />

  <require>org.nuxeo.ecm.core.repository.RepositoryService</require>
  
  <service>
    <provide interface="org.nuxeo.ecm.platform.management.statuses.ProbeScheduler" />
    <provide interface="org.nuxeo.ecm.platform.management.statuses.ProbeRunner" />
    <provide interface="org.nuxeo.ecm.platform.management.statuses.AdministrativeStatus"/>
  </service>

  <require>org.nuxeo.runtime.management.ResourcePublisher</require>

  <extension-point name="probes">
    <object class="org.nuxeo.ecm.platform.management.statuses.ProbeDescriptor" />
  </extension-point>

  <extension 
  	target="org.nuxeo.ecm.platform.scheduler.core.service.SchedulerRegistryService"
  	point="schedule">
  	<schedule id="probeSchedule">
          <username>ProbeScheduler</username>
          <password></password>
          <eventId>probeSchedule</eventId>
          <eventCategory>default</eventCategory>
          <cronExpression>0 0/5 * * * ?</cronExpression>
     </schedule>
  </extension>

  <extension target="org.nuxeo.ecm.core.event.EventServiceComponent" point="listener">
    <listener name="probeListener" async="false" postCommit="false" class="org.nuxeo.ecm.platform.management.probes.ProbeScheduleListener">
		<event>probeSchedule</event>
    </listener>
  </extension>
  
  <extension
    target="org.nuxeo.ecm.platform.management.statuses"
    point="probes">
    <usecase name="repository"
      class="org.nuxeo.ecm.platform.management.statuses.probes.RepositoryProbe"
      serviceClass="org.nuxeo.ecm.core.api.repository.RepositoryManager"/>
    <usecase name="repositoryTest"
      class="org.nuxeo.ecm.platform.management.statuses.probes.RepositoryTestProbe"
      serviceClass="org.nuxeo.ecm.core.api.repository.RepositoryManager"/>
    <usecase name="administrativeStatus"
      class="org.nuxeo.ecm.platform.management.statuses.probes.AdministrativeStatusProbe"
      serviceClass="org.nuxeo.ecm.core.api.repository.RepositoryManager"/>
  </extension>
      
  <extension target="org.nuxeo.ecm.core.schema.TypeService" point="schema">
    <schema name="status" src="schemas/status.xsd" />
  </extension>
  
   <extension target="org.nuxeo.ecm.core.schema.TypeService" point="doctype">
   
  <doctype name="AdministrativeStatusContainer" extends="Folder">
    <facet name="HiddenInNavigation" />
   </doctype>
  
  <doctype name="AdministrativeStatus" extends="Document">
      <schema name="status" />
    </doctype>
  </extension>

</component>
