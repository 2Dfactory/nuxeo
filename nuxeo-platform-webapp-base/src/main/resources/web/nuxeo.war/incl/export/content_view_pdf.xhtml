<f:subview xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:p="http://jboss.com/products/seam/pdf">

<c:if test="false">
  displays a content view using PDF JSF library.

  accepted parameters:
  - from request: contentViewName, currentPage, pageSize, contentViewState
</c:if>

  <nxu:set var="contentViewName" value="#{request.getParameter('contentViewName')}">
  <nxu:set var="currentPage" value="#{request.getParameter('currentPage')}">
  <nxu:set var="pageSize" value="#{request.getParameter('pageSize')}">
  <nxu:set var="contentViewState" value="#{request.getParameter('contentViewState')}">
  <nxu:set var="sortInfos" value="#{contentViewRestActions.getSortInfos('dc:modified', false)}">

  <nxu:set var="contentView"
    value="#{contentViewRestActions.restoreContentView(contentViewName, nxu:test(!empty currentPage, currentPage, -1), nxu:test(!empty pageSize, pageSize, -1), sortInfos, contentViewState)}"
    cache="true">
  <nxu:set var="selectedResultLayoutColumns"
    value="#{nxu:test(selectedResultLayoutColumns == null, contentView.currentResultLayoutColumns, selectedResultLayoutColumns)}"
    cache="true">
  <nxu:set var="provider" value="#{contentView.currentPageProvider}"
    cache="true">

    <c:set var="title"
      value="#{nxu:test(contentView.translateTitle, messages[contentView.title], contentView.title)}" />
    <c:set var="titleOrId"
      value="#{nxu:test(empty title, contentViewName, title)}" />

    <p:document title="#{titleOrId}" orientation="landscape"
      fileName="#{contentViewName}.pdf">

      <f:facet name="header">
        <p:footer borderWidthTop="1" borderColorTop="blue"
          borderWidthBottom="0" alignment="center">
          #{titleOrId} [<p:pageNumber />]
        </p:footer>
      </f:facet>
      
      <p:paragraph>#{titleOrId}</p:paragraph>
      <p:image value="/icons/workspace.gif" />
    
      <c:set var="emptySentence"
        value="#{nxu:test(contentView.translateEmptySentence, messages[contentView.emptySentence], contentView.emptySentence)}" />
      <c:if test="#{documents.rowCount == 0 and not provider.hasError()}">
        <p:paragraph>
          #{nxu:test(empty emptySentence, messages['label.content.emptyFolder'], emptySentence)}
        </p:paragraph>
      </c:if>

      <c:if test="#{provider.hasError()}">
        <p:paragraph>
          #{provider.errorMessage}
        </p:paragraph>
      </c:if>

      #{layoutColumnCounter.setCurrentIndex(0)}
      <nxu:set var="countRows" value="true">
        <nxl:layout name="#{contentView.currentResultLayout.name}"
          mode="pdf" selectedColumns="#{selectedResultLayoutColumns}"
          value="" />
      </nxu:set>

      <p:table columns="#{layoutColumnCounter.currentIndex}" headerRows="1">
        <c:forEach var="row" items="#{provider.currentSelectPage.rows}"
          varStatus="layoutListingStatus">
          <c:set var="showListingHeader" value="#{layoutListingStatus.index == 0}" />
          <nxl:layout name="#{contentView.currentResultLayout.name}"
            value="#{row}" mode="pdf"
            selectedColumns="#{selectedResultLayoutColumns}" />
        </c:forEach>
      </p:table>

    </p:document>

  </nxu:set>
  </nxu:set>
  </nxu:set>
  </nxu:set>
  </nxu:set>
  </nxu:set>
  </nxu:set>
  </nxu:set>

</f:subview>