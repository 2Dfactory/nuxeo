<f:subview
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  id="foldable_#{layout.id}">

  <c:set var="layoutTemplateToInclude"
    value="#{nxu:test(!empty layoutProperty_layoutTemplateToInclude, layoutProperty_layoutTemplateToInclude, '/layouts/default_layout_template.xhmtl')}" />

  <a4j:region renderRegionOnly="true">

    <a4j:outputPanel layout="block" id="foldable_#{layout.id}_panel">

    <c:set var="hasLocalConfigurationFacet"
      value="#{nxu:test(currentDocument.hasFacet(layoutProperty_localConfigurationFacet), true, false)}" />
    <c:set var="titleClass"
      value="#{nxu:test(hasLocalConfigurationFacet, 'unfolded', 'foldedDisabled')}" />


      <div class="foldableBox">
        <h3 class="#{titleClass}">
          <c:if test="#{hasLocalConfigurationFacet}">
            <a href="#nologo" onclick="return toggleBox(this)">
              <c:if test="#{not empty layoutProperty_foldableBoxLabel}">
                <h:outputText value="#{messages[layoutProperty_foldableBoxLabel]}" />
              </c:if>
            </a>
          </c:if>
          <c:if test="#{not hasLocalConfigurationFacet}">
            <c:if test="#{not empty layoutProperty_foldableBoxLabel}">
              <h:outputText value="#{messages[layoutProperty_foldableBoxLabel]}" />
            </c:if>
          </c:if>
          <h:graphicImage value="/icons/lightbulb.png"
            onmouseover="tooltip.show('#{messages[layoutProperty_helpLabel]}', 500);"
            onmouseout="tooltip.hide();" />

          <c:if test="#{not empty layoutProperty_localConfigurationFacet}">
            <a4j:commandLink action="#{localConfigurationActions.toggleConfiguration(layoutProperty_localConfigurationFacet)}"
              immediate="true" reRender="foldable_#{layout.id}_panel" rendered="#{not hasLocalConfigurationFacet}"
              styleClass="action">
              <h:outputText value="#{messages['label.local.configuration.enable']}"/>
            </a4j:commandLink>
            <a4j:commandLink action="#{localConfigurationActions.toggleConfiguration(layoutProperty_localConfigurationFacet)}"
              immediate="true" reRender="foldable_#{layout.id}_panel" rendered="#{hasLocalConfigurationFacet}"
              styleClass="action">
              <h:outputText value="#{messages['label.local.configuration.disable']}"/>
            </a4j:commandLink>
          </c:if>

        </h3>
        <c:if test="#{hasLocalConfigurationFacet}">
        <div class="boxBody" >
          <ui:include src="#{layoutTemplateToInclude}" />
        </div>
        </c:if>
      </div>

    </a4j:outputPanel>
  </a4j:region>

</f:subview>
