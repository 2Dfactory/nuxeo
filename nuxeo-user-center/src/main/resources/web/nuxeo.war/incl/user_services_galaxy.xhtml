<div xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxh="http://nuxeo.org/nxweb/html"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<c:if test="false">
  Forked from Nuxeo for the Sprint days.
  TODO: refactor the user_services_galaxy.xhtml file from Nuxeo
  to be able to contribute a fragment for the "user login".
</c:if>

  <script type="text/javascript">

  jQuery(document).ready(function(){

  	jQuery('ul.subnav').parent().append('<span></span>');

  	jQuery('ul.topnav li span').click(function() {

  		jQuery(this).parent().find('ul.subnav').slideDown('fast').show();

  		jQuery(this).parent().hover(function() {
  		}, function(){
  			jQuery(this).parent().find('ul.subnav').slideUp('slow');
  		});


  		}).hover(function() {
  			jQuery(this).addClass('subhover');
  		}, function(){	//On Hover Out
  			jQuery(this).removeClass('subhover');
  	});

  });

  </script>

  <style>

  ul.topnav {
  	list-style: none;
  	padding: 0 14px 0 0;
  	margin: 0;
  	background: #222;
  	background: url(topnav_bg.gif) repeat-x;
  }
  ul.topnav li {
  	float: left;
  	margin: 0;
  	padding: 0 14px 0 0;
  	position: relative; /*--Declare X and Y axis base for sub navigation--*/
  }
  ul.topnav li a{
  	padding: 5px;
  	color: #fff;
  	display: block;
  	text-decoration: none;
  	float: left;
  }
  ul.topnav li a:hover{
  	background: url(topnav_hover.gif) no-repeat center top;
  }
  ul.topnav li span { /*--Drop down trigger styles--*/
  	width: 17px;
  	height: 20px;
  	float: left;
    padding: 0 8px 0 0;
  	background: url(subnav_btn.gif) no-repeat center top;
  }
  ul.topnav li span.subhover {background-position: center bottom; cursor: pointer;} /*--Hover effect for trigger--*/
  ul.topnav li ul.subnav {
  	list-style: none;
  	position: absolute; /*--Important - Keeps subnav from affecting main navigation flow--*/
  	left: 0; top: 20px;
  	background: #333;
  	margin: 0; padding: 0;
  	display: none;
  	float: left;
  	border: 1px solid #111;
    width: 120px;
  }
  ul.topnav li ul.subnav li{
  	margin: 0; padding: 0;
  	border-top: 1px solid #252525; /*--Create bevel effect--*/
  	border-bottom: 1px solid #444; /*--Create bevel effect--*/
  	clear: both;
  }
  ul.topnav li ul.subnav li a {
  	float: left;
  	background: #333 url(dropdown_linkbg.gif) no-repeat 10px center;
  	padding: 5px;
  }
  ul.topnav li ul.subnav li a:hover { /*--Hover effect for subnav links--*/
  	background: #222 url(dropdown_linkbg.gif) no-repeat 10px center;
  }

  </style>


<ui:insert name="user">

  <h:form id="userServicesSearchForm">
    <div class="searchService">

      <c:if test="#{userServicesContext.searchEnabled}">
        <h:inputText value="#{documentSearchActions.simpleSearchKeywords}" size="15"
          class="directoryFilter"
          onkeydown="if (event.keyCode == 13) {Element.next(Element.next(this)).select();} else return true;"
          id="simpleSearchKeywordsInput"
          required="true" requiredMessage="#{messages['feedback.search.noKeywords']}"
          validator="#{documentSearchActions.validateSimpleSearchKeywords}" />
        <h:commandButton action="search_results_simple"
          value="#{messages['command.search']}" styleClass="button"
          id="simpleSearchSubmitButton" />

        <nxu:set var="actions"
          value="#{webActions.getActionsList('SEARCH_ACTIONS')}"
          cache="true">
          <nxu:dataList layout="simple"
            var="action"
            value="#{actions}"
            id="searchActionsTable">
            <span class="advancedSearchLink">
              <nxh:commandLink action="#{action.getLink()}"
                value="#{messages[action.label]}"
                immediate="true"
                id="searchActionsButton" />
            </span>
          </nxu:dataList>
        </nxu:set>
      </c:if>
    </div>
  </h:form>

  <h:form id="userServicesForm">
    <div class="searchService">

      <nxu:set var="actions"
        value="#{webActions.getActionsList('SEARCH_LINKS')}"
        cache="true">
        <nxu:dataList layout="simple"
                      var="action"
                      value="#{actions}"
                      rowIndexVar="row"
                      rowCountVar="rowCount"
                      id="searchLinksActionsTable">
          <h:outputText value=" | " rendered="#{row!=rowCount}"/>
          <h:outputLink value="#{baseURL}#{action.getLink()}"
            id="searchLinksActionLink">
            <h:outputText value="#{messages[action.label]}" />
          </h:outputLink>
        </nxu:dataList>
      </nxu:set>

    </div>


    <div class="userActions">

        <ul class="topnav">
            <li>
                <span><h:outputText value="#{nxu:userFullName(currentUser.name)}" /></span>
                <ul class="subnav">
                  <nxu:repeat var="action"
                    value="#{userCenterViews.availableActions}" index="index">
                    <li>
                      <nxh:commandLink action="#{userCenterViews.navigateTo(action)}" id="userCenterAction_#{action.id}">
                        <h:outputText value="#{messages[action.label]}" />
                      </nxh:commandLink>
                    </li>
                  </nxu:repeat>
                </ul>
            </li>
        </ul>

      <nxu:set var="actions"
        value="#{webActions.getActionsList('USER_SERVICES')}"
        cache="true">
        <nxu:dataList layout="simple"
                      var="action"
                      value="#{actions}"
                      rowIndexVar="row"
                      rowCountVar="rowCount"
                      id="userServicesActionsTable">
          <h:outputText value=" | " rendered="#{row!=rowCount}"/>
          <nxh:commandLink action="#{action.getLink()}"
            id="userServicesActionCommandLink">
            <h:outputText value="#{messages[action.label]}" />
          </nxh:commandLink>
        </nxu:dataList>
      </nxu:set>

      <nxu:set var="actions"
        value="#{webActions.getActionsList('USER_SERVICES_BOTTOM')}"
        cache="true">
        <nxu:dataList layout="simple"
                      var="action"
                      value="#{actions}"
                      rowIndexVar="row"
                      rowCountVar="rowCount"
                      id="userServicesBottomActionsTable">
          <h:outputText value=" | " rendered="#{row!=rowCount}"/>

          <nxh:commandLink action="#{action.getLink()}"
            rendered="#{fn:startsWith(action.link,'#')}"
            id="userServicesBottomActionCommandLink">
            <h:outputText value="#{messages[action.label]}" />
          </nxh:commandLink>

          <h:outputLink value="#{baseURL}#{action.link}"
            rendered="#{!(fn:startsWith(action.link,'#'))}"
            id="userServicesBottomActionLink">
            <h:outputText value="#{messages[action.label]}" />
          </h:outputLink>

        </nxu:dataList>
      </nxu:set>

    </div>

  </h:form>

    <c:if test="#{adminMessageActivated}">
    <div style="text-align: center; padding: 5px 5px 5px 25px; border: 1px solid rgb(170, 187, 255); background: url('icons/info.gif') no-repeat 3px center #fff; font: normal 12px Arial,sans-serif; margin:3px;">
         <h:outputText value="#{adminMessage}"/>
    </div>
  </c:if>

</ui:insert>

</div>
